
<!DOCTYPE html>
<html lang="zh-CN" class="loading">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MongoDB - Chaoer&#39;blog</title>
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="google" content="notranslate" />
    <meta name="keywords" content="Fechin,"> 
    <meta name="description" content="个人博客，主要记录学习笔记,MongoDB1.NoSql 介绍NoSQL(NoSQL = Not Only SQL), 意即“不仅仅是SQL”，它指的是非关系型的数据库，是以key-value形式存储，和传统的关系型数据库不一,"> 
    <meta name="author" content="Chaoer"> 
    <link rel="alternative" href="atom.xml" title="Chaoer&#39;blog" type="application/atom+xml"> 
    <link rel="icon" href="/img/favicon.png"> 
    
    
<link rel="stylesheet" href="/css/diaspora.css">

<meta name="generator" content="Hexo 5.4.0"></head>

<body class="loading">
    <span id="config-title" style="display:none">Chaoer&#39;blog</span>
    <div id="loader"></div>
    <div id="single">
    <div id="top" style="display: block;">
    <div class="bar" style="width: 0;"></div>
    <a class="iconfont icon-home image-icon" href="javascript:;" data-url="https://blackchao-script.github.io"></a>
    <div title="播放/暂停" class="iconfont icon-play"></div>
    <h3 class="subtitle">MongoDB</h3>
    <div class="social">
        <div>
            <div class="share">
                <a title="获取二维码" class="iconfont icon-scan" href="javascript:;"></a>
            </div>
            <div id="qr"></div>
        </div>
    </div>
    <div class="scrollbar"></div>
</div>

    <div class="section">
        <div class="article">
    <div class='main'>
        <h1 class="title">MongoDB</h1>
        <div class="stuff">
            <span>九月 27, 2021</span>
            
  <ul class="post-tags-list" itemprop="keywords"><li class="post-tags-list-item"><a class="post-tags-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" rel="tag">数据库</a></li></ul>


        </div>
        <div class="content markdown">
            <h1 id="MongoDB"><a href="#MongoDB" class="headerlink" title="MongoDB"></a>MongoDB</h1><h2 id="1-NoSql-介绍"><a href="#1-NoSql-介绍" class="headerlink" title="1.NoSql 介绍"></a>1.NoSql 介绍</h2><p>NoSQL(NoSQL = Not Only SQL), 意即“不仅仅是SQL”，它指的是非关系型的数据库，是以<code>key-value</code>形式存储，和传统的关系型数据库不一样，不一定遵循传统数据库的一些基本要求，比如说遵循<code>SQL标准</code>ACID属性、表结构等等。NoSQL 最早被提出实在20世纪80年代，在当时更多是强调的是与关系数据库区别对待，最近这些年被提及的更多是强调协助解决大数据等相关问题。NoSQL在大数据时代有自己的意义。</p>
<h3 id="1-1-NoSQL-应用情况介绍"><a href="#1-1-NoSQL-应用情况介绍" class="headerlink" title="1.1 NoSQL 应用情况介绍"></a>1.1 NoSQL 应用情况介绍</h3><p>国内的互联网蓬勃发展，不仅涌现出 BAT（百度，阿里巴巴，腾讯）之类的巨头，也带动了整个互联 网行业的发展，大量的创业型公司如春笋般的涌出，在国家层面也提出了“互联网+”和“万众创业”的口 号。更多传统的行业也开始拥抱互联网。但是无论是做所谓的生态平台还是传统业务的转型，涉及到的业 务是多种多样的。这个时候企业架构师对于应用系统的核心——数据库管理 不仅有传统的 SQL 选项也有了 NoSQL 这种适合特定场景需求的选项。</p>
<p><strong>NoSQL 数据库在以下的这几种情况下比较适用：</strong></p>
<ol>
<li>数据模型比较简单；</li>
<li>需要灵活性更强的IT系统；</li>
<li>对数据库性能要求较高；</li>
<li>不需要高度得到数据一致性；</li>
<li>对于给定的key，比较容易映射复杂值的环境。</li>
</ol>
<h3 id="1-2-NoSQL-发展"><a href="#1-2-NoSQL-发展" class="headerlink" title="1.2 NoSQL 发展"></a>1.2 NoSQL 发展</h3><p><strong>国外</strong> : Google 的 BigTable 和 Amazon 的 Dynamo 使用的就是 NoSQL 型数据库。</p>
<p><strong>国内</strong> : 百度、阿里、腾讯、新浪微博、视觉中国、优酷运营数据分析、飞信空间、豆瓣社区等..</p>
<h3 id="1-3-NoSQL-和传统数据库简单对比"><a href="#1-3-NoSQL-和传统数据库简单对比" class="headerlink" title="1.3 NoSQL 和传统数据库简单对比"></a>1.3 NoSQL 和传统数据库简单对比</h3><p>非结构型数据库。<strong>没有行、列的概念。用 JSON 来存储数据。 集合就相当于“表”，文档就相当于“行”</strong>。</p>
<p><img src="https://www.hualigs.cn/image/614fe21a765b5.jpg"></p>
<h2 id="2-MongoDB-介绍"><a href="#2-MongoDB-介绍" class="headerlink" title="2.MongoDB 介绍"></a>2.MongoDB 介绍</h2><p>MongoDB 是一个介于关系型数据库和非关系型数据库之间的产品，<strong>是非关系数据库当中功能最丰富，最像关系数据库的 NOSQL 数据库</strong>。他支持的数据结构非常松散，是类似 json 和 bson 格式，因此可以存储比较复杂的数据类型。MongoDb 最大的特点就是他<strong>支持的查询语言非常强大</strong>，其语法有点类似于面向对象的查询语 言，几乎可以实现类似关系数据库单表查询的绝大部分功能，而且还支持对数据建立索引。它的特点是高 性能、易部署、易使用，存储数据非常方便。</p>
<h2 id="3-MongoDB-数据库创建、删除、表（集合）-创建删除、数据的增、删、改、查"><a href="#3-MongoDB-数据库创建、删除、表（集合）-创建删除、数据的增、删、改、查" class="headerlink" title="3.MongoDB 数据库创建、删除、表（集合） 创建删除、数据的增、删、改、查"></a>3.MongoDB 数据库创建、删除、表（集合） 创建删除、数据的增、删、改、查</h2><h3 id="3-1-连接数据库"><a href="#3-1-连接数据库" class="headerlink" title="3.1 连接数据库"></a>3.1 连接数据库</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// 连接数据库</span><br><span class="line">mongo</span><br><span class="line">// 清屏</span><br><span class="line">cls</span><br><span class="line">// 查看所有数据库列表</span><br><span class="line">show dbs</span><br></pre></td></tr></table></figure>

<h3 id="3-2-创建数据库、查看、删除数据库"><a href="#3-2-创建数据库、查看、删除数据库" class="headerlink" title="3.2 创建数据库、查看、删除数据库"></a>3.2 创建数据库、查看、删除数据库</h3><img src="https://www.hualigs.cn/image/6150158caeba3.jpg"/>

<ol>
<li><p>使用数据库、创建数据库</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use itying</span><br></pre></td></tr></table></figure>

<p>如果真的想把这个数据库创建成功，那么必须插入一个数据。 数据库中不能直接插入数据，只能往集合(collections)中插入数据。下面命令表示给 itying 数 据库的 user 表中插入数据。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.user.insert(&#123;&quot;name&quot;:&quot;xiaoming&quot;&#125;)</span><br></pre></td></tr></table></figure></li>
<li><p>查看数据库</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show dbs</span><br></pre></td></tr></table></figure></li>
<li><p>显示当前的数据集合(mysql中叫表)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show collections</span><br></pre></td></tr></table></figure></li>
<li><p>删除集合，删除指定的集合 删除表</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">删除集合 db.COLLECTION_NAME.drop()</span><br><span class="line">db.user.drop()</span><br></pre></td></tr></table></figure></li>
<li><p>删除数据库，删除当前所在的数据库</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.dropDatabase()</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="3-3-查找数据"><a href="#3-3-查找数据" class="headerlink" title="3.3 查找数据"></a>3.3 查找数据</h3><ol>
<li><p>查询所有记录</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.user.find()</span><br></pre></td></tr></table></figure>

<p>相当于：select * from user;</p>
</li>
<li><p>查询去掉后的当前聚集集合中的某列的重复数据</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.user.distinct(&quot;name&quot;)</span><br></pre></td></tr></table></figure>

<p>会过滤掉 name 中的相同数据</p>
<p>相当于: select distict name from user;</p>
</li>
<li><p>查询 age = 22 的记录</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.user.find(&#123;&quot;age&quot;:22&#125;)</span><br></pre></td></tr></table></figure>

<p>相当于：select * from user where age = 22</p>
</li>
<li><p>查询 age &gt; 22 的记录</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.user.find(&#123;age: &#123;$gt: 22&#125;&#125;)</span><br></pre></td></tr></table></figure>

<p>相当于：select * from user where age &lt;22</p>
</li>
<li><p>查询 age &lt; 22 的记录</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.user.find(&#123;age: &#123;$lt: 22&#125;&#125;)</span><br></pre></td></tr></table></figure>

<p>相当于：select * from user where age &lt;22</p>
</li>
<li><p>查询 age &gt;= 25 的记录</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.user.find(&#123;age: &#123;$gte: 25&#125;&#125;)</span><br></pre></td></tr></table></figure>

<p>相当于：select * from user where age &gt;= 25</p>
</li>
<li><p>查询 age &lt;= 25 的记录</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.user.find(&#123;age: &#123;$lte: 25&#125;&#125;)</span><br></pre></td></tr></table></figure></li>
<li><p>查询 age &gt;= 23 并且 age &lt;= 26 注意书写格式</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.user.find(&#123;age: &#123;$gte: 23, $lte: 26&#125;&#125;)</span><br></pre></td></tr></table></figure></li>
<li><p>查询 name 中包含 mongo 的数据 模糊查询用于搜索</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.user.find(&#123;name: /mongo/&#125;)</span><br></pre></td></tr></table></figure>

<p>//相当于%% select * from user where name like ‘%mongo%</p>
</li>
<li><p>查询 name 中以 mongo 开头的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.user.find(&#123;name: /^mongo/&#125;)</span><br></pre></td></tr></table></figure>

<p>select * from user where name like ‘mongo%’</p>
</li>
<li><p>查询指定列 name、age 数据</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.user.find(&#123;&#125;, &#123;name: 1, age: 1&#125;)</span><br></pre></td></tr></table></figure>

<p>相当于： select name , age from user</p>
<p>当然 name 也可以用 true 或 false,当用 ture 的情况下河 name:1 效果一样，如果用 false 就 是排除 name，显示 name 以外的列信息。</p>
</li>
<li><p>查询指定列 name、age 数据, age &gt; 25</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.user.find(&#123;age: &#123;$gt: 25&#125;&#125;, &#123;name: 1, age: 1&#125;)</span><br></pre></td></tr></table></figure>

<p>相当于：select name, age from user where age &gt;25</p>
</li>
<li><p>按照年龄排序 1 升序 -1 降序</p>
<p>升序：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.user.find().sort(&#123;age: 1&#125;)</span><br></pre></td></tr></table></figure>

<p>降序：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.user.find().sort(&#123;age: -1&#125;)</span><br></pre></td></tr></table></figure></li>
<li><p>查询 name = zhangsan, age = 22 的数据</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.user.find(&#123;name: &#x27;zhangsan&#x27;, age: 22&#125;)</span><br></pre></td></tr></table></figure>

<p>相当于：select * from user where name = ‘zhangsan’ and age = ‘22’</p>
</li>
<li><p>查询前 5 条数据</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.user.find().limit(5)</span><br></pre></td></tr></table></figure>

<p>相当于：selecttop 5 * from user</p>
</li>
<li><p>查询 10 条以后的数据</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.user.find().skip(10)</span><br></pre></td></tr></table></figure></li>
<li><p>查询在 5-10 之间的数据</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.user.find().limit(10).skip(5)</span><br></pre></td></tr></table></figure>

<p>可用于分页，limit 是 pageSize，skip 是(page-1)*pageSize</p>
</li>
<li><p>or 与 查询</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.user.find(&#123;$or: [&#123;age: 22&#125;, &#123;age: 25&#125;]&#125;)</span><br></pre></td></tr></table></figure>

<p>相当于：select * from user where age = 22 or age = 25</p>
</li>
<li><p>findOne 查询第一条数据</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.user.findOne()</span><br></pre></td></tr></table></figure>

<p>相当于：selecttop 1 * from user; db.user.find().limit(1)</p>
</li>
<li><p>查询某个结果集的记录条数 统计数量</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.user.find(&#123;age: &#123;$gte: 25&#125;&#125;).count()</span><br></pre></td></tr></table></figure>

<p>相当于：select count(*) from user where age &gt;= 20; 如果要返回限制之后的记录数量，要使用 count(true)或者 count(非 0) db.users.find().skip(10).limit(5).count(true)</p>
</li>
</ol>
<h3 id="3-4-修改数据"><a href="#3-4-修改数据" class="headerlink" title="3.4 修改数据"></a>3.4 修改数据</h3><p>修改里面还有查询条件。你要改谁，就告诉mongo。</p>
<p>查找名字叫做小明的，把年龄更改为 16 岁：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.student.update(&#123;&quot;name&quot;:&quot;小明&quot;&#125;,&#123;$set:&#123;&quot;age&quot;:16&#125;&#125;)</span><br></pre></td></tr></table></figure>

<p>查找数学成绩是 70，把年龄更改为 33 岁：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.student.update(&#123;&quot;score.shuxue&quot;:70&#125;,&#123;$set:&#123;&quot;age&quot;:33&#125;&#125;)</span><br></pre></td></tr></table></figure>

<p>更改所有匹配项目：在后面加上 multi : true 即可</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.student.update(&#123;&quot;sex&quot;:&quot;男&quot;&#125;,&#123;$set:&#123;&quot;age&quot;:33&#125;&#125;,&#123;multi: true&#125;)</span><br></pre></td></tr></table></figure>

<p>完整替换，不出现$set 关键字了： 注意</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.student.update(&#123;&quot;name&quot;:&quot;小明&quot;&#125;,&#123;&quot;name&quot;:&quot;大明&quot;,&quot;age&quot;:16&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="3-5-删除数据"><a href="#3-5-删除数据" class="headerlink" title="3.5 删除数据"></a>3.5 删除数据</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">db.collectionsNames.remove( &#123; &quot;borough&quot;: &quot;Manhattan&quot; &#125; )</span><br><span class="line">db.users.remove(&#123;age: 132&#125;)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.restaurants.remove( &#123; &quot;borough&quot;: &quot;Queens&quot; &#125;, &#123; justOne: true &#125; )</span><br></pre></td></tr></table></figure>

<h2 id="4-MongoDb-大数据查询优化、-MongoDB-索引、复合索引、唯一索引、-explain-分-析查询速度"><a href="#4-MongoDb-大数据查询优化、-MongoDB-索引、复合索引、唯一索引、-explain-分-析查询速度" class="headerlink" title="4.MongoDb 大数据查询优化、 MongoDB 索引、复合索引、唯一索引、 explain 分 析查询速度"></a>4.MongoDb 大数据查询优化、 MongoDB 索引、复合索引、唯一索引、 explain 分 析查询速度</h2><h3 id="4-1-索引基础"><a href="#4-1-索引基础" class="headerlink" title="4.1 索引基础"></a>4.1 索引基础</h3><p>索引是对数据库表中一列或多列的值进行排序的一种结构，可以让我们查询数据库变得更快。MongoDB的索引几乎与传统的关系型数据库一摸一样，这其中也包括一些基本的查询优化技巧。</p>
<p>下面是创建索引的命令:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.user.ensureindex(&#123;&quot;username&quot;:1&#125;)</span><br></pre></td></tr></table></figure>

<p>获取当前集合的索引:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.user.getindexes()</span><br></pre></td></tr></table></figure>

<p>删除索引的命令是：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.user.dropindex(&#123;&quot;username&quot;:1&#125;)</span><br></pre></td></tr></table></figure>

<p>在 MongoDB 中，我们同样可以创建复合索引，如： 数字 1 表示 username 键的索引按升序存储，-1 表示 age 键的索引按照降序方式存储。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.user.ensureIndex(&#123;&quot;username&quot;:1, &quot;age&quot;:-1&#125;)</span><br></pre></td></tr></table></figure>

<p>该索引被创建后，基于 username 和 age 的查询将会用到该索引，或者是基于 username 的查询也会用到该索引，<strong>但是只是基于 age 的查询将不会用到该复合索引。因此可以说， 如果想用到复合索引，必须在查询条件中包含复合索引中的前 N 个索引列。</strong>然而如果查询 条件中的键值顺序和复合索引中的创建顺序不一致的话，MongoDB 可以智能的帮助我们调 整该顺序，以便使复合索引可以为查询所用。如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.user.find(&#123;&quot;age&quot;: 30, &quot;username&quot;: &quot;stephen&quot;&#125;)</span><br></pre></td></tr></table></figure>

<p>对于上面示例中的查询条件，MongoDB 在检索之前将会动态的调整查询条件文档的顺 序，以使该查询可以用到刚刚创建的复合索引。 对于上面创建的索引，MongoDB 都会根据索引的 keyname 和索引方向为新创建的索引 自动分配一个索引名，<strong>下面的命令可以在创建索引时为其指定索引名</strong>，如</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.user.ensureIndex(&#123;&quot;username&quot;:1&#125;,&#123;&quot;name&quot;:&quot;userindex&quot;&#125;)</span><br></pre></td></tr></table></figure>

<p><strong>随着集合的增长，需要针对查询中大量的排序做索引。如果没有对索引的键调用 sort， MongoDB 需要将所有数据提取到内存并排序。因此在做无索引排序时，如果数据量过大以 致无法在内存中进行排序，此时 MongoDB 将会报错。</strong></p>
<h3 id="4-2-唯一索引"><a href="#4-2-唯一索引" class="headerlink" title="4.2 唯一索引"></a>4.2 唯一索引</h3><p>在缺省情况下创建的索引均不是唯一索引。下面的示例将创建唯一索引，如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.user.ensureindex(&#123;&quot;userid&quot;:1&#125;,&#123;&quot;unique:true&quot;&#125;)</span><br></pre></td></tr></table></figure>

<p>如果再次插入 userid 重复的文档时，MongoDB 将报错，以提示插入重复键，如:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">db.user.insert(&#123;&quot;userid&quot;:5&#125;)</span><br><span class="line">db.user.insert(&#123;&quot;userid&quot;:5&#125;)</span><br></pre></td></tr></table></figure>

<p>如果插入的文档中不包含 userid 键，那么该文档中该键的值为 null，如果多次插入类似 的文档，MongoDB 将会报出同样的错误，如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">db.user.insert(&#123;&quot;userid1&quot;:5&#125;)</span><br><span class="line">db.user.insert(&#123;&quot;userid1&quot;:5&#125;)</span><br></pre></td></tr></table></figure>

<p>如果在创建唯一索引时已经存在了重复项，我们可以通过下面的命令帮助我们在创建唯 一索引时消除重复文档，仅保留发现的第一个文档，如： 先删除刚刚创建的唯一索引。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.user.dropIndex(&#123;&quot;userid&quot;:1&#125;</span><br></pre></td></tr></table></figure>

<p>插入测试数据，以保证集合中有重复键存在。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.user.remove()</span><br><span class="line">db.user.insert(&#123;&quot;userid&quot;:5&#125;)</span><br><span class="line">db.user.insert(&#123;&quot;userid&quot;:5&#125;)</span><br></pre></td></tr></table></figure>

<p>重新创建唯一索引</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.user.ensureIndex(&#123;&quot;userid&quot;:1&#125;,&#123;&quot;unique&quot;:true &#125;)</span><br></pre></td></tr></table></figure>

<p>我们同样可以创建复合唯一索引，即保证复合键值唯一即可。如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.user.ensureIndex(&#123;&quot;userid&quot;:1,&quot;age&quot;:1&#125;,&#123;&quot;unique&quot;:true&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="4-3-索引的一些参数"><a href="#4-3-索引的一些参数" class="headerlink" title="4.3 索引的一些参数"></a>4.3 索引的一些参数</h3><table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>background</td>
<td>Boolean</td>
<td>建索引过程会阻塞其它数据库操作，background可指定以后台方式创建索引，即增加”background”可选参数。”background”默认值为false</td>
</tr>
<tr>
<td>unique</td>
<td>Boolean</td>
<td>建立的索引是否唯一。指定为true创建唯一索引。默认值为false</td>
</tr>
<tr>
<td>name</td>
<td>string</td>
<td>索引的名称。如果未指定，MongoDB的通过连接索引的字段和排序顺序生成一个索引名称</td>
</tr>
<tr>
<td>dropDups</td>
<td>Boolean</td>
<td>在建立唯一索引时是否删除重复记录，指定true创建唯一索引。默认值为false</td>
</tr>
</tbody></table>
<p>如果在为已有数据的文档创建索引时，可以执行下面的命令，<strong>以使 MongoDB 在后台创 建索引</strong>，这样的创建时就不会阻塞其他操作。但是相比而言，以阻塞方式创建索引，会使整 个创建过程效率更高，但是在创建时 MongoDB 将无法接收其他的操作。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.user.ensureIndex(&#123;&quot;username&quot;:1&#125;,&#123;&quot;background&quot;:true&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="4-4-使用-explain"><a href="#4-4-使用-explain" class="headerlink" title="4.4 使用 explain"></a>4.4 使用 explain</h3><p>explain 是非常有用的工具，会帮助你获得查询方面诸多有用的信息。只要对游标调用该方法，就可以得到查询细节。explain会返回一个文档，而不是游标本身。</p>
<p>explain 会返回查询使用的索引情况，耗时和扫描文档数的统计信息。</p>
<h3 id="4-5-explain-executionStats-查询具体的执行时间"><a href="#4-5-explain-executionStats-查询具体的执行时间" class="headerlink" title="4.5 explain executionStats 查询具体的执行时间"></a>4.5 explain executionStats 查询具体的执行时间</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">db.tablename.find().explain( &quot;executionStats&quot; )</span><br><span class="line">关注输出的如下数值：explain.executionStats.executionTimeMillis</span><br></pre></td></tr></table></figure>

<h2 id="5-Mongodb-账户权限配置"><a href="#5-Mongodb-账户权限配置" class="headerlink" title="5.Mongodb 账户权限配置"></a>5.Mongodb 账户权限配置</h2><h3 id="5-1-创建一个超级管理用户"><a href="#5-1-创建一个超级管理用户" class="headerlink" title="5.1 创建一个超级管理用户"></a>5.1 创建一个超级管理用户</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">use admin</span><br><span class="line">db.createUser(&#123;</span><br><span class="line">user:&#x27;admin&#x27;, pwd:&#x27;123456&#x27;, roles:[&#123;role:&#x27;root&#x27;,db:&#x27;admin&#x27;&#125;]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="5-2-修改-MongoDB-数据库配置文件"><a href="#5-2-修改-MongoDB-数据库配置文件" class="headerlink" title="5.2 修改 MongoDB 数据库配置文件"></a>5.2 修改 MongoDB 数据库配置文件</h3><p>路径:在安装目录下的 bin 文件夹 的 mongod.fig 文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">配置：</span><br><span class="line">security:</span><br><span class="line">  authorization: enabled // 注意规范 空两格</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="5-3-重启-MongoDB-服务"><a href="#5-3-重启-MongoDB-服务" class="headerlink" title="5.3 重启 MongoDB 服务"></a>5.3 重启 MongoDB 服务</h3><p><img src="https://www.hualigs.cn/image/6150411b6f4f0.jpg"></p>
<h3 id="5-4-用超级管理员账户连接数据库"><a href="#5-4-用超级管理员账户连接数据库" class="headerlink" title="5.4 用超级管理员账户连接数据库"></a>5.4 用超级管理员账户连接数据库</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mongo admin -u 用户名 -p 密码</span><br><span class="line">mongo 192.168.1.200:27017/test -u user -p password</span><br></pre></td></tr></table></figure>

<h3 id="5-5-MongoDB-账户权限配置中常用的命令"><a href="#5-5-MongoDB-账户权限配置中常用的命令" class="headerlink" title="5.5 MongoDB 账户权限配置中常用的命令"></a>5.5 MongoDB 账户权限配置中常用的命令</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">show users; // 查看当前库下的用户</span><br><span class="line"></span><br><span class="line">db.dropUser(&quot;admin&quot;) // 删除用户</span><br><span class="line"></span><br><span class="line">db.updateUser(&quot;admin&quot;,&#123;pwd:&quot;password&quot;&#125;) // 修改用户密码</span><br><span class="line"></span><br><span class="line">db.auth(&quot;admin&quot;,&quot;password&quot;)  //密码认证</span><br></pre></td></tr></table></figure>

<h3 id="5-6-连接数据库时需要配置用户密码"><a href="#5-6-连接数据库时需要配置用户密码" class="headerlink" title="5.6 连接数据库时需要配置用户密码"></a>5.6 连接数据库时需要配置用户密码</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> url = <span class="string">&#x27;mongodb://admin:123456@localhost:27017/&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="6-关系型数据库表-集合-与表-集合-之间的几种关系"><a href="#6-关系型数据库表-集合-与表-集合-之间的几种关系" class="headerlink" title="6.关系型数据库表(集合)与表(集合)之间的几种关系"></a>6.关系型数据库表(集合)与表(集合)之间的几种关系</h2><h3 id="6-1-简述关系数据库中表与表的3中2关系"><a href="#6-1-简述关系数据库中表与表的3中2关系" class="headerlink" title="6.1 简述关系数据库中表与表的3中2关系"></a>6.1 简述关系数据库中表与表的3中2关系</h3><ol>
<li><p>一对一的关系</p>
<p>例如：一个人对应一个唯一的身份证号，即为一对一得到关系</p>
</li>
<li><p>一对多关系</p>
<p>例如：一个班级对应多名学生，一个学生只能属于一个班级，即为一对多关系</p>
</li>
<li><p>多对多关系</p>
<p>例如：一个学生可以选多门课程，而一门课程可以被多个学生选修，彼此的对应关系 即是多对多关系</p>
</li>
</ol>
<h3 id="6-2-一对一关系"><a href="#6-2-一对一关系" class="headerlink" title="6.2 一对一关系"></a>6.2 一对一关系</h3><p><img src="https://www.hualigs.cn/image/615050a11ccc8.jpg"></p>
<h3 id="6-3-一对多的关系"><a href="#6-3-一对多的关系" class="headerlink" title="6.3 一对多的关系"></a>6.3 一对多的关系</h3><p><img src="https://www.hualigs.cn/image/6150515a226b9.jpg"></p>
<p><img src="https://www.hualigs.cn/image/6150517e5dbe3.jpg"></p>
<h3 id="6-4-多对多的关系"><a href="#6-4-多对多的关系" class="headerlink" title="6.4 多对多的关系"></a>6.4 多对多的关系</h3><p><img src="https://www.hualigs.cn/image/615051afd382c.jpg"></p>
<h2 id="7-MongoDB-聚合管道（Aggregation-Pipeline）"><a href="#7-MongoDB-聚合管道（Aggregation-Pipeline）" class="headerlink" title="7.MongoDB 聚合管道（Aggregation Pipeline）"></a>7.MongoDB 聚合管道（Aggregation Pipeline）</h2><p>使用聚合管道可以对集合中的文档进行变换组合。</p>
<p><strong>实际项目</strong>: 表关联查询、数据统计</p>
<p>MongoDB 中使用 db.COLLECTION_NAME.aggregate([{},…]) 方法来构建和使用聚合管道。</p>
<h3 id="7-1-MongoDB-Aggregation-管道操作符与表达式"><a href="#7-1-MongoDB-Aggregation-管道操作符与表达式" class="headerlink" title="7.1 MongoDB Aggregation 管道操作符与表达式"></a>7.1 MongoDB Aggregation 管道操作符与表达式</h3><table>
<thead>
<tr>
<th align="left">管道操作符</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="left">$project</td>
<td align="left">增加、删除、重命名字段</td>
</tr>
<tr>
<td align="left">$match</td>
<td align="left">条件匹配。只满足条件的文档才能进入下一阶段</td>
</tr>
<tr>
<td align="left">$limit</td>
<td align="left">限制结果的数量</td>
</tr>
<tr>
<td align="left">$skip</td>
<td align="left">跳过文档的数量</td>
</tr>
<tr>
<td align="left">$sort</td>
<td align="left">条件排序</td>
</tr>
<tr>
<td align="left">$group</td>
<td align="left">条件组合结果 统计</td>
</tr>
<tr>
<td align="left">$lookup</td>
<td align="left">$lookup 操作符 用以引入其它集合的数据 (表关联查询)</td>
</tr>
</tbody></table>
<p><strong>管道表达式：</strong></p>
<p>管道操作符作为”键”，所对应的”值”叫做管道表达式。</p>
<p>例如{$match:{status:”A”}},$match 称为管道操作符，而 status:”A” 称为管道表达式，是管道操作符的操作树(Operand)。</p>
<p>每个管道表达式是一个文档结构，它是由字段名、字段值、和一些白哦大是操作符组成的。</p>
<table>
<thead>
<tr>
<th align="left">常用表达式操作符</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="left">$addToSet</td>
<td align="left">将文档阻断的值去重</td>
</tr>
<tr>
<td align="left">$max</td>
<td align="left">文档指定字段的最大值</td>
</tr>
<tr>
<td align="left">$min</td>
<td align="left">文档指定字段的最小值</td>
</tr>
<tr>
<td align="left">$sum</td>
<td align="left">文档指定字段求和</td>
</tr>
<tr>
<td align="left">$avg</td>
<td align="left">文档指定字段求平均</td>
</tr>
<tr>
<td align="left">$gt</td>
<td align="left">大于给定值</td>
</tr>
<tr>
<td align="left">$lt</td>
<td align="left">小于给定值</td>
</tr>
<tr>
<td align="left">$eq</td>
<td align="left">等于给定值</td>
</tr>
</tbody></table>
<h3 id="7-2-数据模拟"><a href="#7-2-数据模拟" class="headerlink" title="7.2 数据模拟"></a>7.2 数据模拟</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">db.order.insert(&#123;&quot;order_id&quot;:&quot;1&quot;,&quot;uid&quot;:10,&quot;trade_no&quot;:&quot;111&quot;,&quot;all_price&quot;:100,&quot;all_num&quot;:2&#125;)</span><br><span class="line">db.order.insert(&#123;&quot;order_id&quot;:&quot;2&quot;,&quot;uid&quot;:7,&quot;trade_no&quot;:&quot;222&quot;,&quot;all_price&quot;:90,&quot;all_num&quot;:2&#125;)</span><br><span class="line">db.order.insert(&#123;&quot;order_id&quot;:&quot;3&quot;,&quot;uid&quot;:9,&quot;trade_no&quot;:&quot;333&quot;,&quot;all_price&quot;:20,&quot;all_num&quot;:6&#125;)</span><br><span class="line">db.order_item.insert(&#123;&quot;order_id&quot;:&quot;1&quot;,&quot;title&quot;:&quot;商品鼠标 1&quot;,&quot;price&quot;:50,num:1&#125;)</span><br><span class="line">db.order_item.insert(&#123;&quot;order_id&quot;:&quot;1&quot;,&quot;title&quot;:&quot;商品键盘 2&quot;,&quot;price&quot;:50,num:1&#125;)</span><br><span class="line">db.order_item.insert(&#123;&quot;order_id&quot;:&quot;1&quot;,&quot;title&quot;:&quot;商品键盘 3&quot;,&quot;price&quot;:0,num:1&#125;)</span><br><span class="line">db.order_item.insert(&#123;&quot;order_id&quot;:&quot;2&quot;,&quot;title&quot;:&quot;牛奶&quot;,&quot;price&quot;:50,num:1&#125;)</span><br><span class="line">db.order_item.insert(&#123;&quot;order_id&quot;:&quot;2&quot;,&quot;title&quot;:&quot;酸奶&quot;,&quot;price&quot;:40,num:1&#125;)</span><br><span class="line">db.order_item.insert(&#123;&quot;order_id&quot;:&quot;3&quot;,&quot;title&quot;:&quot;矿泉水&quot;,&quot;price&quot;:2,num:5&#125;)</span><br><span class="line">db.order_item.insert(&#123;&quot;order_id&quot;:&quot;3&quot;,&quot;title&quot;:&quot;毛巾&quot;,&quot;price&quot;:10,num:1&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="7-3-project"><a href="#7-3-project" class="headerlink" title="7.3 $project"></a>7.3 $project</h3><p>修改文档的结构，可以用来重命名、增加或删除文档中的字段。</p>
<p>要查找 order 只返回文档中 trade_no 和 all_price 字段</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">db.order.aggregate([</span><br><span class="line">	&#123;</span><br><span class="line">		$project:&#123; trade_no:1, all_price:1 &#125;</span><br><span class="line">	&#125;</span><br><span class="line">])</span><br></pre></td></tr></table></figure>

<p><img src="https://www.hualigs.cn/image/61512d1d29052.jpg"></p>
<h3 id="7-4-match"><a href="#7-4-match" class="headerlink" title="7.4 $match"></a>7.4 $match</h3><p>用于过滤文档。用法类似于 find() 方法中的参数。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">db.order.aggregate([</span><br><span class="line">	&#123;	</span><br><span class="line">		$project:&#123; trade_no:1, all_price:1 &#125;</span><br><span class="line">	&#125;, </span><br><span class="line">	&#123;</span><br><span class="line">		$match:&#123;&quot;all_price&quot;:&#123;$gte:90&#125;&#125;</span><br><span class="line">	&#125;</span><br><span class="line">])</span><br></pre></td></tr></table></figure>



<p><img src="https://www.hualigs.cn/image/61512eb6cb855.jpg"></p>
<h3 id="7-5-group"><a href="#7-5-group" class="headerlink" title="7.5 $group"></a>7.5 $group</h3><p>将集合中的文档进行分组，可用于统计结果。</p>
<p>统计每个订单的数量，按照订单号分组</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">db.order_item.aggregate(</span><br><span class="line">	[</span><br><span class="line">		&#123;</span><br><span class="line">			$group: &#123;_id: &quot;$order_id&quot;, total: &#123;$sum: &quot;$num&quot;&#125;&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	]</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p><img src="https://www.hualigs.cn/image/6151303289144.jpg"></p>
<h3 id="7-6-sort"><a href="#7-6-sort" class="headerlink" title="7.6 $sort"></a>7.6 $sort</h3><p>将集合中的文档进行排序</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">db.order.aggregate([</span><br><span class="line">	&#123;</span><br><span class="line">		$project:&#123; trade_no:1, all_price:1 &#125;</span><br><span class="line">	&#125;, </span><br><span class="line">	&#123;</span><br><span class="line">		$match:&#123;&quot;all_price&quot;:&#123;$gte:90&#125;&#125;</span><br><span class="line">	&#125;, </span><br><span class="line">	&#123;</span><br><span class="line">		$sort:&#123;&quot;all_price&quot;:-1&#125;</span><br><span class="line">	&#125;</span><br><span class="line">])</span><br></pre></td></tr></table></figure>

<p><img src="https://www.hualigs.cn/image/615130d3e7e48.jpg"></p>
<h3 id="7-7-limit"><a href="#7-7-limit" class="headerlink" title="7.7 $limit"></a>7.7 $limit</h3><p>限制结果的数量</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">db.order.aggregate([</span><br><span class="line">	&#123;</span><br><span class="line">		$project:&#123; trade_no:1, all_price:1 &#125;</span><br><span class="line">	&#125;, </span><br><span class="line">	&#123;</span><br><span class="line">		$match:&#123;&quot;all_price&quot;:&#123;$gte:90&#125;&#125;</span><br><span class="line">	&#125;, </span><br><span class="line">	&#123;</span><br><span class="line">		$sort:&#123;&quot;all_price&quot;:-1&#125;</span><br><span class="line">	&#125;, </span><br><span class="line">	&#123;</span><br><span class="line">		$limit:1</span><br><span class="line">	&#125;</span><br><span class="line">])</span><br></pre></td></tr></table></figure>

<h3 id="7-8-skip"><a href="#7-8-skip" class="headerlink" title="7.8 $skip"></a>7.8 $skip</h3><p>跳过文档的数量</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">db.order.aggregate([</span><br><span class="line">	&#123;</span><br><span class="line">		$project:&#123; trade_no:1, all_price:1 &#125;</span><br><span class="line">	&#125;, </span><br><span class="line">	&#123;</span><br><span class="line">		$match:&#123;&quot;all_price&quot;:&#123;$gte:90&#125;&#125;</span><br><span class="line">	&#125;, </span><br><span class="line">	&#123;</span><br><span class="line">		$sort:&#123;&quot;all_price&quot;:-1&#125;</span><br><span class="line">	&#125;,</span><br><span class="line">	&#123;</span><br><span class="line">		$skip:1</span><br><span class="line">	&#125;</span><br><span class="line">])</span><br></pre></td></tr></table></figure>

<h3 id="7-9-lookup-表关联"><a href="#7-9-lookup-表关联" class="headerlink" title="7.9 $lookup 表关联"></a>7.9 $lookup 表关联</h3><p><strong>from</strong>：要关联的表</p>
<p><strong>localField</strong>：主表id</p>
<p><strong>foreignField</strong>：关联表id</p>
<p><strong>as</strong>：查询完成的数据放的位置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">db.order.aggregate([</span><br><span class="line">	&#123;</span><br><span class="line">		$lookup:</span><br><span class="line">		&#123;</span><br><span class="line">			from: &quot;order_item&quot;, </span><br><span class="line">			localField: &quot;order_id&quot;, </span><br><span class="line">			foreignField: &quot;order_id&quot;, </span><br><span class="line">			as: &quot;items&quot;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">])</span><br></pre></td></tr></table></figure>


            <!--[if lt IE 9]><script>document.createElement('audio');</script><![endif]-->
            <audio id="audio" loop="1" preload="auto" controls="controls" data-autoplay="false">
                <source type="audio/mpeg" src="">
            </audio>
            
                <ul id="audio-list" style="display:none">
                    
                        
                            <li title='0' data-url='http://link.hhtjim.com/163/425570952.mp3'></li>
                        
                    
                        
                            <li title='1' data-url='http://link.hhtjim.com/163/425570952.mp3'></li>
                        
                    
                </ul>
            
        </div>
        
    <div id='gitalk-container' class="comment link"
		data-enable='false'
        data-ae='false'
        data-ci=''
        data-cs=''
        data-r=''
        data-o=''
        data-a=''
        data-d='false'
    >查看评论</div>


    </div>
    
        <div class='side'>
			<ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#MongoDB"><span class="toc-number">1.</span> <span class="toc-text">MongoDB</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-NoSql-%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.1.</span> <span class="toc-text">1.NoSql 介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-NoSQL-%E5%BA%94%E7%94%A8%E6%83%85%E5%86%B5%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.1.1.</span> <span class="toc-text">1.1 NoSQL 应用情况介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-NoSQL-%E5%8F%91%E5%B1%95"><span class="toc-number">1.1.2.</span> <span class="toc-text">1.2 NoSQL 发展</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-NoSQL-%E5%92%8C%E4%BC%A0%E7%BB%9F%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AE%80%E5%8D%95%E5%AF%B9%E6%AF%94"><span class="toc-number">1.1.3.</span> <span class="toc-text">1.3 NoSQL 和传统数据库简单对比</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-MongoDB-%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.2.</span> <span class="toc-text">2.MongoDB 介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-MongoDB-%E6%95%B0%E6%8D%AE%E5%BA%93%E5%88%9B%E5%BB%BA%E3%80%81%E5%88%A0%E9%99%A4%E3%80%81%E8%A1%A8%EF%BC%88%E9%9B%86%E5%90%88%EF%BC%89-%E5%88%9B%E5%BB%BA%E5%88%A0%E9%99%A4%E3%80%81%E6%95%B0%E6%8D%AE%E7%9A%84%E5%A2%9E%E3%80%81%E5%88%A0%E3%80%81%E6%94%B9%E3%80%81%E6%9F%A5"><span class="toc-number">1.3.</span> <span class="toc-text">3.MongoDB 数据库创建、删除、表（集合） 创建删除、数据的增、删、改、查</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-%E8%BF%9E%E6%8E%A5%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">1.3.1.</span> <span class="toc-text">3.1 连接数据库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%BA%93%E3%80%81%E6%9F%A5%E7%9C%8B%E3%80%81%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">1.3.2.</span> <span class="toc-text">3.2 创建数据库、查看、删除数据库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-%E6%9F%A5%E6%89%BE%E6%95%B0%E6%8D%AE"><span class="toc-number">1.3.3.</span> <span class="toc-text">3.3 查找数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-%E4%BF%AE%E6%94%B9%E6%95%B0%E6%8D%AE"><span class="toc-number">1.3.4.</span> <span class="toc-text">3.4 修改数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-5-%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE"><span class="toc-number">1.3.5.</span> <span class="toc-text">3.5 删除数据</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-MongoDb-%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96%E3%80%81-MongoDB-%E7%B4%A2%E5%BC%95%E3%80%81%E5%A4%8D%E5%90%88%E7%B4%A2%E5%BC%95%E3%80%81%E5%94%AF%E4%B8%80%E7%B4%A2%E5%BC%95%E3%80%81-explain-%E5%88%86-%E6%9E%90%E6%9F%A5%E8%AF%A2%E9%80%9F%E5%BA%A6"><span class="toc-number">1.4.</span> <span class="toc-text">4.MongoDb 大数据查询优化、 MongoDB 索引、复合索引、唯一索引、 explain 分 析查询速度</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-%E7%B4%A2%E5%BC%95%E5%9F%BA%E7%A1%80"><span class="toc-number">1.4.1.</span> <span class="toc-text">4.1 索引基础</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-%E5%94%AF%E4%B8%80%E7%B4%A2%E5%BC%95"><span class="toc-number">1.4.2.</span> <span class="toc-text">4.2 唯一索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-%E7%B4%A2%E5%BC%95%E7%9A%84%E4%B8%80%E4%BA%9B%E5%8F%82%E6%95%B0"><span class="toc-number">1.4.3.</span> <span class="toc-text">4.3 索引的一些参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4-%E4%BD%BF%E7%94%A8-explain"><span class="toc-number">1.4.4.</span> <span class="toc-text">4.4 使用 explain</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-5-explain-executionStats-%E6%9F%A5%E8%AF%A2%E5%85%B7%E4%BD%93%E7%9A%84%E6%89%A7%E8%A1%8C%E6%97%B6%E9%97%B4"><span class="toc-number">1.4.5.</span> <span class="toc-text">4.5 explain executionStats 查询具体的执行时间</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-Mongodb-%E8%B4%A6%E6%88%B7%E6%9D%83%E9%99%90%E9%85%8D%E7%BD%AE"><span class="toc-number">1.5.</span> <span class="toc-text">5.Mongodb 账户权限配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E8%B6%85%E7%BA%A7%E7%AE%A1%E7%90%86%E7%94%A8%E6%88%B7"><span class="toc-number">1.5.1.</span> <span class="toc-text">5.1 创建一个超级管理用户</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-%E4%BF%AE%E6%94%B9-MongoDB-%E6%95%B0%E6%8D%AE%E5%BA%93%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">1.5.2.</span> <span class="toc-text">5.2 修改 MongoDB 数据库配置文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-%E9%87%8D%E5%90%AF-MongoDB-%E6%9C%8D%E5%8A%A1"><span class="toc-number">1.5.3.</span> <span class="toc-text">5.3 重启 MongoDB 服务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-4-%E7%94%A8%E8%B6%85%E7%BA%A7%E7%AE%A1%E7%90%86%E5%91%98%E8%B4%A6%E6%88%B7%E8%BF%9E%E6%8E%A5%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">1.5.4.</span> <span class="toc-text">5.4 用超级管理员账户连接数据库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-5-MongoDB-%E8%B4%A6%E6%88%B7%E6%9D%83%E9%99%90%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%B8%B8%E7%94%A8%E7%9A%84%E5%91%BD%E4%BB%A4"><span class="toc-number">1.5.5.</span> <span class="toc-text">5.5 MongoDB 账户权限配置中常用的命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-6-%E8%BF%9E%E6%8E%A5%E6%95%B0%E6%8D%AE%E5%BA%93%E6%97%B6%E9%9C%80%E8%A6%81%E9%85%8D%E7%BD%AE%E7%94%A8%E6%88%B7%E5%AF%86%E7%A0%81"><span class="toc-number">1.5.6.</span> <span class="toc-text">5.6 连接数据库时需要配置用户密码</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A1%A8-%E9%9B%86%E5%90%88-%E4%B8%8E%E8%A1%A8-%E9%9B%86%E5%90%88-%E4%B9%8B%E9%97%B4%E7%9A%84%E5%87%A0%E7%A7%8D%E5%85%B3%E7%B3%BB"><span class="toc-number">1.6.</span> <span class="toc-text">6.关系型数据库表(集合)与表(集合)之间的几种关系</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-%E7%AE%80%E8%BF%B0%E5%85%B3%E7%B3%BB%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%AD%E8%A1%A8%E4%B8%8E%E8%A1%A8%E7%9A%843%E4%B8%AD2%E5%85%B3%E7%B3%BB"><span class="toc-number">1.6.1.</span> <span class="toc-text">6.1 简述关系数据库中表与表的3中2关系</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-%E4%B8%80%E5%AF%B9%E4%B8%80%E5%85%B3%E7%B3%BB"><span class="toc-number">1.6.2.</span> <span class="toc-text">6.2 一对一关系</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3-%E4%B8%80%E5%AF%B9%E5%A4%9A%E7%9A%84%E5%85%B3%E7%B3%BB"><span class="toc-number">1.6.3.</span> <span class="toc-text">6.3 一对多的关系</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-4-%E5%A4%9A%E5%AF%B9%E5%A4%9A%E7%9A%84%E5%85%B3%E7%B3%BB"><span class="toc-number">1.6.4.</span> <span class="toc-text">6.4 多对多的关系</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-MongoDB-%E8%81%9A%E5%90%88%E7%AE%A1%E9%81%93%EF%BC%88Aggregation-Pipeline%EF%BC%89"><span class="toc-number">1.7.</span> <span class="toc-text">7.MongoDB 聚合管道（Aggregation Pipeline）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-1-MongoDB-Aggregation-%E7%AE%A1%E9%81%93%E6%93%8D%E4%BD%9C%E7%AC%A6%E4%B8%8E%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="toc-number">1.7.1.</span> <span class="toc-text">7.1 MongoDB Aggregation 管道操作符与表达式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-%E6%95%B0%E6%8D%AE%E6%A8%A1%E6%8B%9F"><span class="toc-number">1.7.2.</span> <span class="toc-text">7.2 数据模拟</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-3-project"><span class="toc-number">1.7.3.</span> <span class="toc-text">7.3 $project</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-4-match"><span class="toc-number">1.7.4.</span> <span class="toc-text">7.4 $match</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-5-group"><span class="toc-number">1.7.5.</span> <span class="toc-text">7.5 $group</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-6-sort"><span class="toc-number">1.7.6.</span> <span class="toc-text">7.6 $sort</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-7-limit"><span class="toc-number">1.7.7.</span> <span class="toc-text">7.7 $limit</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-8-skip"><span class="toc-number">1.7.8.</span> <span class="toc-text">7.8 $skip</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-9-lookup-%E8%A1%A8%E5%85%B3%E8%81%94"><span class="toc-number">1.7.9.</span> <span class="toc-text">7.9 $lookup 表关联</span></a></li></ol></li></ol></li></ol>	
        </div>
    
</div>


    </div>
</div>
</body>


<script src="//lib.baomitu.com/jquery/1.8.3/jquery.min.js"></script>
<script src="/js/plugin.js"></script>
<script src="/js/typed.js"></script>
<script src="/js/diaspora.js"></script>


<link rel="stylesheet" href="/photoswipe/photoswipe.css">
<link rel="stylesheet" href="/photoswipe/default-skin/default-skin.css">


<script src="/photoswipe/photoswipe.min.js"></script>
<script src="/photoswipe/photoswipe-ui-default.min.js"></script>


<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>
    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">
        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>
        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">
            <div class="pswp__top-bar">
                <!--  Controls are self-explanatory. Order can be changed. -->
                <div class="pswp__counter"></div>
                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
                <button class="pswp__button pswp__button--share" title="Share"></button>
                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>
            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>
            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>
            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>
            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>
        </div>
    </div>
</div>






</html>
